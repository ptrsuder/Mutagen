
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mutagen-modding.github.io/Mutagen/plugins/Binary-Overlay/">
      
      
        <link rel="prev" href="../Binary-Importing/">
      
      
        <link rel="next" href="../Interfaces-%28Aspect-Link-Getters%29/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Binary Overlay - Mutagen Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../Custom/Stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#binary-overlay" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mutagen Documentation" class="md-header__button md-logo" aria-label="Mutagen Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mutagen Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Binary Overlay
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Mutagen-Modding/Mutagen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Mutagen-Modding/Mutagen
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mutagen Documentation" class="md-nav__button md-logo" aria-label="Mutagen Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Mutagen Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Mutagen-Modding/Mutagen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Mutagen-Modding/Mutagen
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../top/Big-Cheat-Sheet/" class="md-nav__link">
        Big Cheat Sheet
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Plugin Record Suite</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Plugin Record Suite" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Plugin Record Suite
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ModKey%2C-FormKey%2C-FormLink/" class="md-nav__link">
        ModKey, FormKey, FormLink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Generated-Classes/" class="md-nav__link">
        Generated Classes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Binary-Importing/" class="md-nav__link">
        Binary Importing
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Binary Overlay
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Binary Overlay
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reasoning-for-an-alternate-pattern" class="md-nav__link">
    Reasoning for an Alternate Pattern
  </a>
  
    <nav class="md-nav" aria-label="Reasoning for an Alternate Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-usage-is-frontloaded" class="md-nav__link">
    Memory Usage is Frontloaded
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-must-specify-interest" class="md-nav__link">
    User Must Specify Interest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all-records-are-parsed-for-interest-groups" class="md-nav__link">
    All Records are Parsed (for Interest Groups)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-overlay-concepts" class="md-nav__link">
    Introduction to Overlay Concepts
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Overlay Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#it-returns-a-getter-interface" class="md-nav__link">
    It returns a Getter interface.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-an-open-stream" class="md-nav__link">
    Requires an open Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-up-front-parsing-work" class="md-nav__link">
    No Up Front Parsing Work
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-persistent-references-to-records-or-memory" class="md-nav__link">
    No Persistent References to Records or Memory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example" class="md-nav__link">
    Concrete Example
  </a>
  
    <nav class="md-nav" aria-label="Concrete Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-work-is-actually-done-by-this-code" class="md-nav__link">
    What work is actually done by this code?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-some-things-that-were-not-done" class="md-nav__link">
    What are some things that were not done?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-overview" class="md-nav__link">
    Summary Overview
  </a>
  
    <nav class="md-nav" aria-label="Summary Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pros" class="md-nav__link">
    Pros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cons" class="md-nav__link">
    Cons:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Interfaces-%28Aspect-Link-Getters%29/" class="md-nav__link">
        Interfaces (Aspect/Link/Getters)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Copy-Functionality/" class="md-nav__link">
        Copy Functionality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Binary-Exporting/" class="md-nav__link">
        Binary Exporting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Equality-Checks/" class="md-nav__link">
        Equality Checks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Translation-Masks/" class="md-nav__link">
        Translation Masks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Flags-and-Enums/" class="md-nav__link">
        Flags and Enums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AssetLink/" class="md-nav__link">
        Asset Links
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Binary-Format-Complexity-Abstraction/" class="md-nav__link">
        Binary Format Complexity Abstraction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Create%2C-Duplicate%2C-and-Override/" class="md-nav__link">
        Create, Duplicate, and Override
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Abstract-Subclassing/" class="md-nav__link">
        Abstract Subclassing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Printing/" class="md-nav__link">
        Printing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Typical-Mod-Construction-and-Importing/" class="md-nav__link">
        Typical Mod Construction and Importing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../FormKey-Allocation-and-Persistence.md" class="md-nav__link">
        FormKey Allocation and Persistence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../environment/">Environment</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Environment" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../environment/Environment-Construction/" class="md-nav__link">
        Environment Construction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../environment/Game-Locations/" class="md-nav__link">
        Game Locations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../linkcache/">Link Cache</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Link Cache" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Link Cache
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkcache/Record-Lookup/" class="md-nav__link">
        Record Lookup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkcache/ModContexts/" class="md-nav__link">
        Mod Contexts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linkcache/Previous-Override-Iteration/" class="md-nav__link">
        Previous Override Iteration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../loadorder/">Load Order</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Load Order" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Load Order
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../loadorder/Winning-Overrides/" class="md-nav__link">
        Winning Override Iteration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../top/Archives/" class="md-nav__link">
        Archives (BSAs)
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8" tabindex="0" aria-expanded="false">
          Strings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Strings" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Strings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../strings/Translated-Strings/" class="md-nav__link">
        Translated Strings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9" tabindex="0" aria-expanded="false">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/Print-Some-Content/" class="md-nav__link">
        Print Some Content
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/Low-Level-Examples/" class="md-nav__link">
        Low Level Examples
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10" tabindex="0" aria-expanded="false">
          Getting Familiar with C#
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Familiar with C#" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Getting Familiar with C#
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../familiar/Namespaces/" class="md-nav__link">
        Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../familiar/Nullability-to-Indicate-Record-Presence/" class="md-nav__link">
        Nullability to Indicate Record Presence
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_11" tabindex="0" aria-expanded="false">
          Best Practices and Optimizations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Best Practices and Optimizations" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Best Practices and Optimizations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/Getters-Everywhere/" class="md-nav__link">
        Getters Everywhere
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/Accessing-Known-Records/" class="md-nav__link">
        Accessing Known Records
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/FormLinks-Always-Target-Getter-Interfaces/" class="md-nav__link">
        FormLinks Always Target Getter Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/FormLinks-vs-EditorID-as-Identifiers/" class="md-nav__link">
        FormLinks vs EditorID as Identifiers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/FormLink-vs-FormLinkNullable/" class="md-nav__link">
        FormLink vs FormLinkNullable
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/Enumerable-Laziness/" class="md-nav__link">
        Enumerable Laziness
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/TryGet-Concepts/" class="md-nav__link">
        TryGet Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/ITPO-Avoidance/" class="md-nav__link">
        ITPO Avoidance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/Reuse-Translation-Masks/" class="md-nav__link">
        Reuse Translation Masks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/Modifying-Groups-Being-Iterated/" class="md-nav__link">
        Modifying Groups Being Iterated
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../wpf/">WPF Library</a>
          
            <label for="__nav_12">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="WPF Library" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          WPF Library
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wpf/FormKey-Picker/" class="md-nav__link">
        FormKey Picker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wpf/ModKey-Picker/" class="md-nav__link">
        ModKey Picker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wpf/Reflection-Powered-Settings/" class="md-nav__link">
        Reflection Powered Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wpf/Adding-Required-Resources/" class="md-nav__link">
        Adding Required Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FormKey-Allocation-and-Persistence.md" class="md-nav__link">
        FormKey Allocation/Persistence
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../top/Json/" class="md-nav__link">
        Json
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../..">Low Level Tools</a>
          
            <label for="__nav_15">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Low Level Tools" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Low Level Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lowlevel/C%23-Span/" class="md-nav__link">
        C# Span
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lowlevel/Header-Structs/" class="md-nav__link">
        Header Structs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lowlevel/Game-Constants/" class="md-nav__link">
        Game Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lowlevel/Binary-Streams/" class="md-nav__link">
        Binary Streams
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lowlevel/Binary-Utility/" class="md-nav__link">
        Binary Utility
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_16" tabindex="0" aria-expanded="false">
          Game Specific Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Game Specific Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Game Specific Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_16_1" type="checkbox" id="__nav_16_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_16_1" tabindex="0" aria-expanded="false">
          Oblivion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Oblivion" data-md-level="2">
        <label class="md-nav__title" for="__nav_16_1">
          <span class="md-nav__icon md-icon"></span>
          Oblivion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../game-specific/oblivion/Oblivion-Aspect-Interfaces/" class="md-nav__link">
        Oblivion Aspect Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../game-specific/oblivion/Oblivion-Link-Interfaces/" class="md-nav__link">
        Oblivion Link Interfaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_16_2" type="checkbox" id="__nav_16_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_16_2" tabindex="0" aria-expanded="false">
          Skyrim
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Skyrim" data-md-level="2">
        <label class="md-nav__title" for="__nav_16_2">
          <span class="md-nav__icon md-icon"></span>
          Skyrim
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../game-specific/skyrim/Skyrim-Perks/" class="md-nav__link">
        Skyrim Perks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../game-specific/skyrim/Skyrim-Aspect-Interfaces/" class="md-nav__link">
        Skyrim Aspect Interfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../game-specific/skyrim/Skyrim-Link-Interfaces/" class="md-nav__link">
        Skyrim Link Interfaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../top/Correctness/" class="md-nav__link">
        Correctness
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reasoning-for-an-alternate-pattern" class="md-nav__link">
    Reasoning for an Alternate Pattern
  </a>
  
    <nav class="md-nav" aria-label="Reasoning for an Alternate Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-usage-is-frontloaded" class="md-nav__link">
    Memory Usage is Frontloaded
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-must-specify-interest" class="md-nav__link">
    User Must Specify Interest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all-records-are-parsed-for-interest-groups" class="md-nav__link">
    All Records are Parsed (for Interest Groups)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-overlay-concepts" class="md-nav__link">
    Introduction to Overlay Concepts
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Overlay Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#it-returns-a-getter-interface" class="md-nav__link">
    It returns a Getter interface.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-an-open-stream" class="md-nav__link">
    Requires an open Stream
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-up-front-parsing-work" class="md-nav__link">
    No Up Front Parsing Work
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-persistent-references-to-records-or-memory" class="md-nav__link">
    No Persistent References to Records or Memory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concrete-example" class="md-nav__link">
    Concrete Example
  </a>
  
    <nav class="md-nav" aria-label="Concrete Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-work-is-actually-done-by-this-code" class="md-nav__link">
    What work is actually done by this code?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-some-things-that-were-not-done" class="md-nav__link">
    What are some things that were not done?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-overview" class="md-nav__link">
    Summary Overview
  </a>
  
    <nav class="md-nav" aria-label="Summary Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pros" class="md-nav__link">
    Pros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cons" class="md-nav__link">
    Cons:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="binary-overlay">Binary Overlay</h1>
<p>Binary Overlays are an alternative to the more simplistic <a href="../Binary-Importing/">Binary Importing</a> concepts.</p>
<h2 id="reasoning-for-an-alternate-pattern">Reasoning for an Alternate Pattern</h2>
<h3 id="memory-usage-is-frontloaded">Memory Usage is Frontloaded</h3>
<p>One of the downsides of typical importing is that all the data must be read into an object upfront and continues existing in memory until the object is released to the GC.  Many operations only want to process each record once and then move on.  They do not need all the records to exist in memory at the same time and would actually prefer if they weren't.</p>
<h3 id="user-must-specify-interest">User Must Specify Interest</h3>
<p>Additionally, the user must specify to the import function all of the record types that they are interested in.  Otherwise, the import function will parse and create records for everything in the mod, wasting time and memory usage.  If the user fails to list a record type, but then proceeds to query for them, then bugs can occur.</p>
<h3 id="all-records-are-parsed-for-interest-groups">All Records are Parsed (for Interest Groups)</h3>
<p>When a specific Group is marked for interest and imported, all aspects of those Records are parsed and created in memory with no regard to whether the user will actually make use of them all.  This is a lot of wasted work and memory usage for data that will go unused.</p>
<h2 id="introduction-to-overlay-concepts">Introduction to Overlay Concepts</h2>
<p>The Binary Overlay concept is an alternate method of importing/reading mods in an on-demand and transient way.  One of its main features is that only fields that are accessed get parsed, which saves a lot of time and work.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OblivionMod</span><span class="p">.</span><span class="n">CreateFromBinaryOverlay</span><span class="p">(</span><span class="n">pathToMod</span><span class="p">);</span>
<span class="c1">// Code accessing the mod</span>
</code></pre></div>
Some differences:</p>
<h3 id="it-returns-a-getter-interface">It returns a <code>Getter</code> interface.</h3>
<p>You can only read from an overlay.  You cannot modify it.</p>
<h3 id="requires-an-open-stream">Requires an open Stream</h3>
<p>Binary Overlays keep reference to an open stream internally, so they can read it as appropriate.  This helps parse things in a lazy fashion, so that only the applicable data is processed and in-memory.  Binary Overlay objects implement <code>IDisposable</code>, which closes the stream when they are disposed.  Putting them in <code>using</code> statements to close when appropriate is good practice.</p>
<h3 id="no-up-front-parsing-work">No Up Front Parsing Work</h3>
<p>With the overlay pattern, a mod object is returned almost immediately for use after having done almost no parsing.  As the user accesses members of the <code>Mod</code>, the parsing is done on demand for only the members accessed.</p>
<h3 id="no-persistent-references-to-records-or-memory">No Persistent References to Records or Memory</h3>
<p>Binary Overlays keep no internal references to any record objects.  This means that when a user is done working with something and discards it, the GC is allowed to immediately clean it up.</p>
<h2 id="concrete-example">Concrete Example</h2>
<p>It might be useful to walk through a concrete example, and some of the mechanics going on under the hood.  Consider this code:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">IOblivionModGetter</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OblivionMod</span><span class="p">.</span><span class="n">CreateFromBinaryOverlay</span><span class="p">(</span><span class="n">pathToMod</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">potion</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mod</span><span class="p">.</span><span class="n">Potions</span><span class="p">.</span><span class="n">Records</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Check if the record has an EditorID, and get it</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">potion</span><span class="p">.</span><span class="n">EditorID</span><span class="p">.</span><span class="n">TryGet</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">edid</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
<span class="w">      </span><span class="c1">// Print the result</span>
<span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">edid</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
This code is intended to print each Potion's Editor ID to the console.</p>
<h3 id="what-work-is-actually-done-by-this-code">What work is actually done by this code?</h3>
<ul>
<li>A file is opened</li>
<li>An overlay class that implements <code>IOblivionModGetter</code> and has a reference to the file stream is instantiated.</li>
<li>Quick skip-over parsing of the file is done to locate the locations of the Groups.</li>
<li>User accesses the Potion Group.</li>
<li>A Group overlay object is created, and the Potion Group's raw bytes are read from the file.</li>
<li>Group overlay object marks all locations of Potion records in its data.</li>
<li>User loops over all Potions in the Group.</li>
<li>For each loop iteration, an <code>IPotionGetter</code> overlay object is created, pointing to the memory location for that record.</li>
<li>The potion overlay object marks the location of all subrecords it contains.</li>
<li>The user retrieves the EditorID (once), and checks if is set.</li>
<li>The EDID subrecord is parsed from the byte array as a string and returned.</li>
<li>The string is printed to the console.</li>
<li>After loop is over, the stream is closed.</li>
</ul>
<h3 id="what-are-some-things-that-were-not-done">What are some things that were not done?</h3>
<ul>
<li>No Groups besides Potion were parsed. Their top level locations were noted, but no contents were processed.</li>
<li>No subrecords were parsed, except EditorID (EDID).</li>
<li>No object had a reference to all the Potion records, so as to keep their contents in memory.  The Group object simply has a list of locations.  The user has the only reference to any Potion record at any given moment, and as soon as they were done with it was cleaned up.</li>
<li>No extra code was written by the user to help indicate they were only interested in Potions or EditorIDs.  Writing code that accessed them was the implicit indication of interest itself.</li>
</ul>
<h2 id="summary-overview">Summary Overview</h2>
<p>The Binary Overlay concept is a powerful tool that can be used for vast speed/memory improvements for certain jobs.  It is suggested for use in most importing scenarios.  Actual normal record objects should generally be reserved for use when constructing new/modified records for output.</p>
<h3 id="pros">Pros</h3>
<ul>
<li>Much faster as there is no parsing of fields that are not used.</li>
<li>No need to specify ahead of time which records will be used.</li>
<li>Much lower memory footprint as records only exist as the user is interacting with them.</li>
</ul>
<h3 id="cons">Cons:</h3>
<ul>
<li>The source stream must remain open for the lifetime of the overlay.</li>
<li>Any access of the mod or group objects can only be done if the stream is open.</li>
<li>Overlays are readonly, so copies to new objects must be made if user wishes to modify contents.</li>
<li>Parsing is done on access, which means repeated accesses means multiple parsing of the same data.  </li>
</ul>
<h1 id="best-practices">Best Practices</h1>
<p>As noted above, the Overlay pattern has the downside that repeated access of properties means repeated parsing of the same data.  While this may sound scary at first, it shouldn't pose much of a problem in most scenarios as parsing is very quick.  Most caching solutions that attempt to "fix" this quality will probably be slower and come with the additional downside of bloating memory usage.</p>
<p>However, this parse-per-access quality does encourage a slightly different coding pattern if you want to squeeze out the tiniest optimization.  Ideally you still want to access properties as little as possible when you can.  Here are some suggestions and tricks:</p>
<h3 id="example-of-misuse">Example of Misuse</h3>
<p>Here is an example of very slight misuse (only when using an Overlay):
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">npcOverlay</span><span class="p">.</span><span class="n">EditorID</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;NPC&#39;s EditorID was: {npcOverlay.EditorID}&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Why is this bad practice?  Because <code>npcOverlay.EditorID</code> was accessed twice, and so the byte to string parsing for EditorID was executed twice.  In reality, this isn't the biggest deal as it's a small amount of data, and the parsing is extremely quick.  But we're here to talk about optimization and best practices.</p>
<h3 id="save-to-variable">Save to Variable</h3>
<p>One simple way to reduce access calls when you know you're going to be doing several in a row is to just save the single access to a variable:
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">editorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npcOverlay</span><span class="p">.</span><span class="n">EditorID</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">editorID</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;NPC&#39;s EditorID was: {editorID}&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
This is a simple way to remove the redundant access/parse.</p>
<h3 id="group-access-special-case">Group Access Special Case</h3>
<p>Accessing a Group on a binary overlay mod object is a special case that is even more expensive.  The mod objects are designed to open the file and read the contents from disk at the Group level.  Compared to normal records/fields which multiple accesses will just result in parsing the same memory twice, multiple accesses of the same group will result in multiple reads of the content off the disk.  This is much slower.  </p>
<p>As such, Groups should receive extra care to only access them once.  As a simple example using the tip describe above:
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">overlayMod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>

<span class="c1">// Retrieve the group once</span>
<span class="kt">var</span><span class="w"> </span><span class="n">npcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">overlayMod</span><span class="p">.</span><span class="n">Npcs</span><span class="p">;</span>

<span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">thing</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">things</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// Use the same variable many times</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">npcs</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">thing</span><span class="p">.</span><span class="n">FormKey</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">record</span><span class="p">))</span>
<span class="w">      </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="pattern-matching">Pattern Matching</h3>
<p>It is a very common pattern that a member might not be set.  An alternate way of dealing with this is via Pattern Matching:
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">npcOverlay</span><span class="p">.</span><span class="n">EditorID</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">editorID</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;NPC&#39;s EditorID was {editorID}&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
<p>This provides a nice if-exists-then-do pattern, where <code>EditorID</code> is only parsed once and its result exposed in a non-null <code>string</code> variable to use inside the if statement.</p>
<p>If you want a more <code>var</code>-like behavior, you can also consider this pattern
<div class="highlight"><pre><span></span><code>if (npcOverlay.EditorID is {} editorID)
{
    System.Console.WriteLine($&quot;NPC&#39;s EditorID was {editorID}&quot;);
}
</code></pre></div></p>
<p>You no longer need to specify the type <code>string</code>, but it's an odd looking pattern.  C# might introduce a better looking one in the future.</p>
<h3 id="safe-navigation-operator">Safe Navigation Operator</h3>
<p>In C#, a call on a potentially null member can be short circuited easily by adding a Safe Navigation Operator (<code>?</code>).  This does a null check, and only calls the function or retrieves the data if it is not null.  Here's how it might be used:
<div class="highlight"><pre><span></span><code><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;NPC&#39;s EditorID was {npcOverlay.EditorID?.ToString()}&quot;</span><span class="p">);</span>
</code></pre></div>
<code>ToString()</code> is only called if EditorID is not null.  It has the upside of only accessing the property once before calling the function, and so is proper practice when calling functions on Overlay members that could be null.</p>
<h3 id="null-coalescing-operator">Null Coalescing Operator</h3>
<p>Another common operator related to potentially null items is the Null Coalescing operator (<code>??</code>).  This checks if an item is null, and if so, returns a second value.
<div class="highlight"><pre><span></span><code><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;NPC&#39;s EditorID was {npcOverlay.EditorID ?? &quot;</span><span class="n">UNKNOWN</span><span class="s">&quot;}&quot;</span><span class="p">);</span>
</code></pre></div>
This will access and return EditorID, unless it is null, at which point "UNKNOWN" will be returned and printed.  It also has the upside of only accessing the property once before calling the function, and so is proper practice when accessing Overlay members that could be null.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/Mutagen-Modding" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>